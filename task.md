# Task: Centralized AuthZ & Performance Optimization

## Status
- [x] **Analyze Architecture**
    - [x] Review Gateway & IAM codebase
    - [x] Identify decentralized AuthZ issues
- [x] **Design Centralized AuthZ**
    - [x] Create API Workflow for Business Service (`API_WORKFLOW_BUSINESS.md`)
    - [x] Create Implementation Plan (`implementation_plan_authz.md`)
    - [x] Update Plan for Dynamic DB-Driven Policy
- [x] **Implement IAM Service (AuthZ Source)**
    - [x] Create `EndpointProtection` Entity
    - [x] Create `EndpointProtectionRepository`
    - [x] Implement `InternalAuthZController`
    - [x] Update `UserRepository` for optimized permission fetching
    - [x] Create Database Migrations (V4, V5)
- [x] **Implement Gateway Service (Enforcement)**
    - [x] Create `AuthZService` (L1/L2 Caching)
    - [x] Create `PolicyManager` (Dynamic Rule Sync)
    - [x] Create `CentralizedAuthZFilter`
- [x] **Implement Business Service Optimization**
    - [x] Create `Product` Entity & Repository
    - [x] Implement `ProductService` with `@Cacheable` (L2 Redis)
    - [x] Configure `CacheConfig` (Caffeine L1 support)
- [x] **Verification**
    - [x] Run `mvn clean install`
    - [ ] Verify Startup (Optional / User Manual)
- [x] **Frontend Integration (Product Page)**
    - [x] Create Backend `ProductController`
    - [x] Create Frontend Model & Service
    - [x] Create `ProductListComponent`
    - [x] Configure Routing (`/products`)
- [x] **Phase 2: Production Readiness & Missing Services**
    - [x] **Refactor Process Management Service**
        - [x] Standardize Package Structure
        - [x] Update POM & Dependencies
        - [x] Configure Docker & CI/CD
    - [x] **Implement Integration Service**
        - [x] Create Service Scaffold (Port 8084)
        - [x] Implement Caching (L1 Caffeine + L2 Redis)
        - [x] Implement Auth Strategy (JWT/Public Key)
    - [x] **IAM Service Enhancements**
        - [x] Add Client Auth Controller
    - [x] **Infrastructure**
        - [x] Update Docker Compose
        - [x] Verify Build (mvn clean install)
- [x] **Phase 3: Product Workflow Integration**
    - [x] **Update Product Entity**
        - [x] Add `status` field (DRAFT, PENDING_APPROVAL, etc.)
        - [x] Add `processInstanceId` field
    - [x] **Implement Protobuf Messages**
        - [x] Define `ProcessRequest` (Business → Process Service)
        - [x] Define `ProductStatusChangedEvent` (Process → Business Service)
    - [x] **Implement RabbitMQ Integration**
        - [x] Create `RequestProducer` (send process requests)
        - [x] Create `ProductStatusConsumer` (receive status updates)
        - [x] Update `RabbitMQConfig` (queues, exchanges, bindings)
    - [x] **Implement Controllers**
        - [x] Create `ProcessRequestController` (manual workflow trigger)
        - [x] Update `ProductController` (auto-trigger workflow on create)
    - [ ] **Verification**
        - [/] Run `mvn clean install`
        - [ ] Manual Testing (Optional)

